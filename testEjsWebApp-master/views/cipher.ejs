<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改密码</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- basic styles -->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/font-awesome.min.css">
    <link rel="stylesheet" href="/public/css/ace.min.css">
    <link rel="stylesheet" href="/public/css/ace-rtl.min.css">
    <link rel="stylesheet" href="/public/css/ace-skins.min.css">
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/js/ace-extra.min.js"></script>
    <script src="/public/js/jquery.cookie.js"></script>
    <style>
        .page-content1 {
            margin: 0;
            padding: 8px 20px 24px;
        }
    </style>
</head>
<body>
    <script>
        function validate() {                  
            var pwd = $("#newcode").val();
            var pwd1 = $("#affirmcode").val();

            if (pwd == '' || pwd1 == '') {
                $("#codeBtn").attr("disabled","disabled"); 
            } else {
                if (pwd == pwd1) {
                    $("#tip").html("两次密码相同");
                    $("#tip").css("color","green");
                    $("#codeBtn").removeAttr("disabled");
                } else {
                    $("#tip").html("两次密码不相同");
                    $("#tip").css("color","red")
                    $("#codeBtn").attr("disabled","disabled");  
                }
            }
        }
        function empty() {
            var pwd = $("#oldcode").val();
            if (pwd == '') {
                $("#codeBtn").attr("disabled","disabled"); 
            } else {
                if (pwd == '' || pwd1 == '') {
                    $("#codeBtn").attr("disabled","disabled"); 
                } else {
                    $("#codeBtn").removeAttr("disabled");
                }
                
            }
        }
    </script>
    <script>
        $(document).ready(function () {
            $("#codeBtn").click(function () {
                $.ajax({
                    url: "/cipher",//路由，用来处理ajax请求的函数的所在地址
                    type: "PUT",
                    data: {
                        oldcode: $("#oldcode").val(),   
                        newcode: $("#newcode").val(),
                        affirmcode: $("#affirmcode").val()
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            alert("密码修改成功,请重新登录")
                            $.removeCookie("userinfo", { path: '/' });  //密码修改成功后删除原cookie
                            $.removeCookie("prj001token", { path: '/' });
                            $.removeCookie("usertoken", { path: '/' });
                            $.removeCookie("userid", { path: '/' });
                            window.location.href = '/';    //    请求成功后跳转到你的主页
                        } else {
                            alert("密码修改失败:" + data.msg);
                            window.location.href = '/cipher';
                        }
                    },
                    error: function () {
                        alert("密码修改失败");
                        window.location.href = '/home';
                    }
                });
            });
        });
    </script>
    <%include header.ejs %>
<!-- 登录 -->
<div class="page-content1">
    <div class="row">
        <div class="col-xs-3" style="width:21%">
            <table>
                <tbody>
                <tr>
                    <th><label for="oldcode">旧密码:</label></th>
                    <td><input type="password" name="oldcode" maxlength="50" required="" id="oldcode" onkeyup="empty();"/></td>
                </tr>
                <tr>
                    <th><label for="newcode">新密码:</label></th>
                    <td><input type="password" name="newcode" required="true" id="newcode" onkeyup="validate();"/></td>                   
                </tr>
                <tr>
                    <th><label for="affirmcode">确认新密码:</label></th>
                    <td><input type="password" name="affirmcode" required="true" id="affirmcode" onkeyup="validate();"/></td>
                </tr>
                </tbody>
            </table>
            <span id="tip"></span>
            <br>
            <button type="submit" id="codeBtn" disabled>确认修改</button>
            </div>
                    <p style="color:darkgray">你的密码不能与其他个人信息太相似。</p >
                    <p style="color:darkgray">你的密码必须包含至少 8 个字符。</p >
                    <p style="color:darkgray">你的密码不能是大家都爱用的常见密码。</p >
                    <p style="color:darkgray">你的密码不能全部为数字。</p >

            </div>
    </div>
</div>


<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

<script type="text/javascript">
    if("ontouchend" in document) document.write("<script src='/public/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="/public/js/bootstrap.min.js"></script>
<script src="/public/js/typeahead-bs2.min.js"></script>

<!-- page specific plugin scripts -->

<!-- ace scripts -->

<script src="../public/js/ace-elements.min.js"></script>
<script src="../public/js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + ""));
</script>
</body>
</html>