<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改密码</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- basic styles -->
    <link rel="stylesheet" href="../public/css/bootstrap.min.css">
    <link rel="stylesheet" href="../public/css/font-awesome.min.css">
    <link rel="stylesheet" href="../public/css/ace.min.css">
    <link rel="stylesheet" href="../public/css/ace-rtl.min.css">
    <link rel="stylesheet" href="../public/css/ace-skins.min.css">
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="../public/js/ace-extra.min.js"></script>

    <style>
        .page-content1 {
            margin: 0;
            padding: 8px 20px 24px;
        }
    </style>
</head>
<body>
    <script>
        $(".tip").hide();
        function checknewcode(){//当第一个密码框失去焦点时，触发checkpas1事件
            $(".tip").hide();
          var pas1=document.getElementById("newcode").value;
          var pas2=document.getElementById("affirmcode").value;//获取两个密码框的值
        //   var reg = new RegExp(/^.*(?=.{8,32})(?=.*\d)(?=.*[A-Z]{2,})(?=.*[a-z]{1,}).*$/);
        //   if (!reg.test(pas1)) {
        //     $(".tip-newcode").show();
        //   }
          if(pas1!=pas2){//此事件当两个密码不相等且第二个密码是空的时候会显示错误信息
            $(".tip").show();}
          else {
            $(".tip").hide();//若两次输入的密码相等且都不为空时，不显示错误信息。
          }
        function checkaffirmcode(){//当第一个密码框失去焦点时，触发checkpas2件
          var pas1=document.getElementById("newcode").value;
          var pas2=document.getElementById("affirmcode").value;//获取两个密码框的值
          if(pas1!=pas2){
            $(".tip").show();//当两个密码不相等时则显示错误信息
          }else{
            $(".tip").hide();
          }
          }
        function checkpas2(){//点击提交按钮时，触发checkpas2事件，会进行弹框提醒以防无视错误信息提交
          var pas3=document.getElementById("newcode").value;
          var pas4=document.getElementById("affirmcode").value;
          if(pas3!=pas4){
            alert("两次输入的密码不一致！");
            return false;
          }
        }
    </script>
    <script>
        $(document).ready(function () {
            $("#codeBtn").click(function () {
                $.ajax({
                    url: "/cipher",//路由，用来处理ajax请求的函数的所在地址
                    type: "PUT",
                    data: {
                        oldcode: $("#oldcode").val(),   
                        newcode: $("#newcode").val(),
                        affirmcode: $("#affirmcode").val()
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            alert("密码修改成功,请重新登录")
                            window.location.href = '/';    //    请求成功后跳转到你的主页
                        } else {
                            alert("密码修改失败");
                            window.location.href = '/cipher';
                        }
                    },
                    error: function () {
                        alert("修改失败");
                        window.location.href = '/home';
                    }
                });
            });
        });
    </script>
<!-- 导航 -->
<div class="navbar navbar-default" id="navbar">
    <script type="text/javascript">
        try {ace.settings.check('navbar','fixed')}catch (e) {}
    </script>

    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="../home" class="navbar-brand">
                <small>
                    <i class="icon-leaf">
                        中医妇科临床流调数据中心
                    </i>
                </small>
            </a>
        </div>
    </div>

    <div class="navbar-header pull-right" role="navigation">
        <ul class="nav ace-nav">
            <li class="light-blue">
                <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                    <img class="nav-user-photo" src="../public/avatars/0017030553263367_b.jpg" alt="Jason's Photo">
                    <span class="user-info">
                        <small>欢迎,</small>
                        <%= username %>
                    </span>

                    <i class="icon-caret-down"></i>
                </a>

                <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">

                    <li class="divider"></li>

                    <li>
                        <a href="../logout">
                            <i class="icon-off"></i>
                            注销
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<!-- 登录 -->
<div class="page-content1">
    <div class="row">
        <div class="col-xs-3" style="width:21%">
            <table>
                <tbody>
                <tr>
                    <th><label for="oldcode">旧密码:</label></th>
                    <td><input type="password" name="oldcode" maxlength="50" required="" id="oldcode"/></td>
                </tr>
                <tr>
                    <th><label for="newcode">新密码:</label></th>
                    <td><input type="password" name="newcode" required="true" id="newcode" onblur="checknewcode();"/>
                    </td>
                    
                </tr>
                <tr>
                    <th><label for="affirmcode">确认新密码:</label></th>
                    <td><input type="password" name="affirmcode" required="true" id="affirmcode" onblur="checkaffirmcode();"/></td>
                </tr>
                </tbody>
            </table>
            <button type="submit" id="codeBtn">确认修改</button>
            </div>
                    <p style="color:darkgray">你的密码不能与其他个人信息太相似。</p >
                    <p style="color:darkgray">你的密码必须包含至少 8 个字符。</p >
                    <p style="color:darkgray">你的密码不能是大家都爱用的常见密码。</p >
                    <p style="color:darkgray">你的密码不能全部为数字。</p >

            </div>
    </div>
</div>


<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

<script type="text/javascript">
    if("ontouchend" in document) document.write("<script src='js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="../public/js/bootstrap.min.js"></script>
<script src="../public/js/typeahead-bs2.min.js"></script>

<!-- page specific plugin scripts -->

<!-- ace scripts -->

<script src="../public/js/ace-elements.min.js"></script>
<script src="../public/js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + ""));
</script>
</body>
</html>